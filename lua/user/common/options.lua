--[[
=====================================================================
                    ОБЩИЕ НАСТРОЙКИ NEOVIM
=====================================================================
Этот файл содержит базовые настройки Vim, которые работают
как в VSCode/Windsurf, так и в standalone Neovim.

Загружается первым перед всеми плагинами.
=====================================================================
--]]

local opt = vim.opt
local g = vim.g

-- =====================================================================
-- ЛИДЕР КЛАВИША
-- =====================================================================
-- Пробел как лидер-клавиша (должен быть установлен до загрузки плагинов)
g.mapleader = " "
g.maplocalleader = " "

-- =====================================================================
-- НУМЕРАЦИЯ СТРОК
-- =====================================================================
opt.number = true         -- Показывать номера строк
opt.relativenumber = true -- Относительная нумерация (удобно для навигации)

-- =====================================================================
-- ОТСТУПЫ И ТАБУЛЯЦИЯ
-- =====================================================================
opt.tabstop = 2           -- Ширина табуляции в пробелах
opt.shiftwidth = 2        -- Количество пробелов для автоотступа
opt.expandtab = true      -- Заменять табуляцию пробелами
opt.autoindent = true     -- Копировать отступ с текущей строки
opt.smartindent = true    -- Умные отступы для кода

-- =====================================================================
-- ПОИСК
-- =====================================================================
opt.ignorecase = true     -- Игнорировать регистр при поиске
opt.smartcase = true      -- Учитывать регистр если есть заглавные буквы
opt.hlsearch = true       -- Подсвечивать результаты поиска
opt.incsearch = true      -- Показывать совпадения во время ввода

-- =====================================================================
-- БУФЕР ОБМЕНА
-- =====================================================================
-- Синхронизация с системным буфером обмена
-- Откладываем до UiEnter для ускорения запуска
vim.schedule(function()
  opt.clipboard = "unnamedplus"
end)

-- =====================================================================
-- ИСТОРИЯ ОТМЕНЫ (UNDO)
-- =====================================================================
if vim.fn.has("persistent_undo") == 1 then
  local undodir = vim.fn.stdpath("data") .. "/undo_history"
  if vim.fn.isdirectory(undodir) == 0 then
    vim.fn.mkdir(undodir, "p")
  end
  opt.undodir = undodir
  opt.undofile = true      -- Сохранять историю отмены в файл
  opt.undolevels = 1000    -- Максимум уровней отмены
  opt.undoreload = 10000   -- Максимум строк для сохранения при перезагрузке
end

-- =====================================================================
-- СКРОЛЛИНГ
-- =====================================================================
opt.scrolloff = 8         -- Минимум строк над/под курсором
opt.sidescrolloff = 8     -- Минимум колонок слева/справа от курсора

-- =====================================================================
-- РАЗНОЕ
-- =====================================================================
opt.wrap = false          -- Не переносить длинные строки
opt.linebreak = true      -- Переносить по словам (если wrap включен)
opt.mouse = "a"           -- Включить мышь во всех режимах
opt.splitbelow = true     -- Новые окна открывать снизу
opt.splitright = true     -- Новые окна открывать справа
opt.termguicolors = true  -- Поддержка 24-bit цветов
opt.signcolumn = "yes"    -- Всегда показывать колонку знаков
opt.cursorline = true     -- Подсвечивать текущую строку
opt.updatetime = 250      -- Время до CursorHold события (мс)
opt.timeoutlen = 300      -- Время ожидания комбинации клавиш (мс)
opt.completeopt = "menu,menuone,noselect" -- Опции автодополнения

-- =====================================================================
-- ФОРМАТИРОВАНИЕ
-- =====================================================================
opt.formatoptions = "jcroqlnt" -- Опции автоформатирования
opt.shortmess:append({ W = true, I = true, c = true, C = true })

-- =====================================================================
-- ФАЙЛЫ И КОДИРОВКА
-- =====================================================================
opt.encoding = "utf-8"    -- Кодировка по умолчанию
opt.fileencoding = "utf-8"
opt.backup = false        -- Не создавать backup файлы
opt.swapfile = false      -- Не создавать swap файлы

print("✓ Общие настройки загружены")
