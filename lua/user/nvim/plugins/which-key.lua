--[[
=====================================================================
                          WHICH-KEY
=====================================================================
Показывает подсказки сочетаний клавиш (AstroNvim style).

При нажатии лидер-клавиши (<Space>) появляется окно со всеми
доступными сочетаниями клавиш и их описаниями.

Группы клавиш (AstroNvim):
  <leader>f - Find (поиск)
  <leader>b - Buffers (буферы)
  <leader>g - Git
  <leader>l - LSP / Language Tools
  <leader>u - UI/UX toggles
  <leader>t - Terminal
  <leader>x - Quickfix/Lists
  <leader>S - Session
  <leader>p - Packages

GitHub: https://github.com/folke/which-key.nvim
=====================================================================
--]]

return {
  "folke/which-key.nvim",
  event = "VeryLazy",

  opts = {
    -- ═══════════════════════════════════════════════════════════════
    -- ОСНОВНЫЕ НАСТРОЙКИ
    -- ═══════════════════════════════════════════════════════════════
    preset = "modern",

    delay = function(ctx)
      return ctx.plugin and 0 or 200
    end,

    -- ═══════════════════════════════════════════════════════════════
    -- ИКОНКИ
    -- ═══════════════════════════════════════════════════════════════
    icons = {
      breadcrumb = "»",
      separator = "➜",
      group = "+",
      ellipsis = "…",
      mappings = true,
      rules = {},
      colors = true,
      keys = {
        Up = " ",
        Down = " ",
        Left = " ",
        Right = " ",
        C = "󰘴 ",
        M = "󰘵 ",
        D = "󰘳 ",
        S = "󰘶 ",
        CR = "󰌑 ",
        Esc = "󱊷 ",
        ScrollWheelDown = "󱕐 ",
        ScrollWheelUp = "󱕑 ",
        NL = "󰌑 ",
        BS = "󰁮",
        Space = "󱁐 ",
        Tab = "󰌒 ",
        F1 = "󱊫",
        F2 = "󱊬",
        F3 = "󱊭",
        F4 = "󱊮",
        F5 = "󱊯",
        F6 = "󱊰",
        F7 = "󱊱",
        F8 = "󱊲",
        F9 = "󱊳",
        F10 = "󱊴",
        F11 = "󱊵",
        F12 = "󱊶",
      },
    },

    -- ═══════════════════════════════════════════════════════════════
    -- ОКНО
    -- ═══════════════════════════════════════════════════════════════
    win = {
      no_overlap = true,
      border = "rounded",
      padding = { 1, 2 },
      title = true,
      title_pos = "center",
      zindex = 1000,
    },

    -- ═══════════════════════════════════════════════════════════════
    -- РАСКЛАДКА
    -- ═══════════════════════════════════════════════════════════════
    layout = {
      width = { min = 20 },
      spacing = 3,
    },

    -- ═══════════════════════════════════════════════════════════════
    -- ФИЛЬТРЫ
    -- ═══════════════════════════════════════════════════════════════
    filter = function(mapping)
      return true
    end,

    -- ═══════════════════════════════════════════════════════════════
    -- ТРИГГЕРЫ
    -- ═══════════════════════════════════════════════════════════════
    triggers = {
      { "<auto>", mode = "nxsot" },
    },

    disable = {
      bt = {},
      ft = { "TelescopePrompt" },
    },
  },

  config = function(_, opts)
    local wk = require("which-key")
    wk.setup(opts)

    -- ═══════════════════════════════════════════════════════════════
    -- ГРУППЫ КЛАВИШ (AstroNvim style)
    -- ═══════════════════════════════════════════════════════════════
    -- wk.add({
    --   -- ─────────────────────────────────────────────────────────────
    --   -- Find / Search (<leader>f)
    --   -- ─────────────────────────────────────────────────────────────
    --   { "<leader>f", group = "Поиск", icon = "" },
    --   { "<leader>f<CR>", desc = "Продолжить предыдущий поиск" },
    --   { "<leader>ff", desc = "Найти файлы" },
    --   { "<leader>fF", desc = "Найти все файлы" },
    --   { "<leader>fg", desc = "Найти git-файлы" },
    --   { "<leader>fw", desc = "Найти слова (grep)" },
    --   { "<leader>fW", desc = "Найти слова во всех файлах" },
    --   { "<leader>fc", desc = "Найти слово под курсором" },
    --   { "<leader>fC", desc = "Найти команды" },
    --   { "<leader>fb", desc = "Найти буферы" },
    --   { "<leader>fo", desc = "Открыть недавние файлы" },
    --   { "<leader>fO", desc = "Открыть недавние файлы (cwd)" },
    --   { "<leader>fh", desc = "Найти справку" },
    --   { "<leader>fk", desc = "Найти keymaps" },
    --   { "<leader>fm", desc = "Найти man-страницы" },
    --   { "<leader>fn", desc = "Найти уведомления" },
    --   { "<leader>f'", desc = "Найти метки" },
    --   { "<leader>fr", desc = "Найти регистры" },
    --   { "<leader>fs", desc = "Умный поиск" },
    --   { "<leader>ft", desc = "Найти темы" },
    --   { "<leader>fu", desc = "Найти историю undo" },
    --   { "<leader>fl", desc = "Найти строки" },
    --   { "<leader>fp", desc = "Найти проекты" },
    --   { "<leader>fa", desc = "Найти файлы конфигурации" },

    --   -- ─────────────────────────────────────────────────────────────
    --   -- Buffers (<leader>b)
    --   -- ─────────────────────────────────────────────────────────────
    --   { "<leader>b", group = "Буферы", icon = "" },
    --   { "<leader>bb", desc = "Найти буферы" },
    --   { "<leader>bd", desc = "Закрыть буфер" },
    --   { "<leader>bD", desc = "Закрыть все буферы" },
    --   { "<leader>bo", desc = "Закрыть остальные буферы" },
    --   { "<leader>bp", desc = "Предыдущий буфер" },

    --   -- ─────────────────────────────────────────────────────────────
    --   -- Git (<leader>g)
    --   -- ─────────────────────────────────────────────────────────────
    --   { "<leader>g", group = "Git", icon = "" },
    --   { "<leader>gg", desc = "Lazygit" },
    --   { "<leader>gb", desc = "Git-ветки" },
    --   { "<leader>gc", desc = "Коммиты Git (репозиторий)" },
    --   { "<leader>gC", desc = "Коммиты Git (файл)" },
    --   { "<leader>gt", desc = "Статус Git" },
    --   { "<leader>gT", desc = "Git stash" },
    --   { "<leader>go", desc = "Открыть в Git (browse)" },
    --   { "<leader>gB", desc = "Blame для строки" },

    --   -- Git hunks (<leader>gh)
    --   { "<leader>gh", group = "Git hunks", icon = "" },
    --   { "<leader>ghs", desc = "Проиндексировать hunk" },
    --   { "<leader>ghr", desc = "Сбросить hunk" },
    --   { "<leader>ghS", desc = "Проиндексировать буфер" },
    --   { "<leader>ghR", desc = "Сбросить буфер" },
    --   { "<leader>ghp", desc = "Просмотр hunk" },
    --   { "<leader>ghb", desc = "Blame для строки" },
    --   { "<leader>ghd", desc = "Diff" },

    --   -- ─────────────────────────────────────────────────────────────
    --   -- LSP / Language Tools (<leader>l)
    --   -- ─────────────────────────────────────────────────────────────
    --   { "<leader>l", group = "LSP", icon = "" },
    --   { "<leader>la", desc = "Действия кода" },
    --   { "<leader>lr", desc = "Переименовать" },
    --   { "<leader>lf", desc = "Форматировать" },
    --   { "<leader>ld", desc = "Диагностика строки" },
    --   { "<leader>lD", desc = "Все диагностики" },
    --   { "<leader>ls", desc = "Символы документа" },
    --   { "<leader>lG", desc = "Символы рабочей области" },
    --   { "<leader>li", desc = "Информация LSP" },
    --   { "<leader>lR", desc = "Переименовать файл" },

    --   -- TypeScript specific
    --   { "<leader>lo", desc = "Организовать импорты" },
    --   { "<leader>lu", desc = "Удалить неиспользуемое" },
    --   { "<leader>lm", desc = "Добавить отсутствующие импорты" },

    --   -- ─────────────────────────────────────────────────────────────
    --   -- UI/UX Toggles (<leader>u)
    --   -- ─────────────────────────────────────────────────────────────
    --   { "<leader>u", group = "UI/UX", icon = "" },
    --   { "<leader>ub", desc = "Переключить фон" },
    --   { "<leader>ud", desc = "Переключить диагностику" },
    --   { "<leader>uD", desc = "Скрыть уведомления" },
    --   { "<leader>uh", desc = "Переключить inlay hints" },
    --   { "<leader>ul", desc = "Переключить статус-линию" },
    --   { "<leader>uL", desc = "Переключить относительные номера" },
    --   { "<leader>un", desc = "Переключить номера строк" },
    --   { "<leader>uN", desc = "Переключить уведомления" },
    --   { "<leader>us", desc = "Переключить проверку орфографии" },
    --   { "<leader>uS", desc = "Переключить скрытие текста (conceal)" },
    --   { "<leader>ut", desc = "Переключить tabline" },
    --   { "<leader>uT", desc = "Переключить treesitter" },
    --   { "<leader>uv", desc = "Переключить виртуальный текст" },
    --   { "<leader>uw", desc = "Переключить перенос строк" },
    --   { "<leader>uZ", desc = "Переключить режим zen" },
    --   { "<leader>u|", desc = "Переключить направляющие отступов" },

    --   -- ─────────────────────────────────────────────────────────────
    --   -- Terminal (<leader>t)
    --   -- ─────────────────────────────────────────────────────────────
    --   { "<leader>t", group = "Терминал", icon = "" },
    --   { "<leader>tf", desc = "Терминал во всплывающем окне" },
    --   { "<leader>th", desc = "Терминал горизонтальный" },
    --   { "<leader>tv", desc = "Терминал вертикальный" },
    --   { "<leader>tl", desc = "Lazygit" },

    --   -- ─────────────────────────────────────────────────────────────
    --   -- Quickfix/Lists (<leader>x)
    --   -- ─────────────────────────────────────────────────────────────
    --   { "<leader>x", group = "Quickfix/списки", icon = "" },
    --   { "<leader>xq", desc = "Список quickfix" },
    --   { "<leader>xl", desc = "Список расположения (location list)" },

    --   -- ─────────────────────────────────────────────────────────────
    --   -- Session (<leader>S)
    --   -- ─────────────────────────────────────────────────────────────
    --   { "<leader>S", group = "Сессии", icon = "" },
    --   { "<leader>Ss", desc = "Сохранить сессию" },
    --   { "<leader>Sl", desc = "Загрузить последнюю сессию" },
    --   { "<leader>Sd", desc = "Удалить сессию" },
    --   { "<leader>Sf", desc = "Найти сессии" },
    --   { "<leader>S.", desc = "Загрузить сессию для текущей папки" },

    --   -- ─────────────────────────────────────────────────────────────
    --   -- Packages (<leader>p)
    --   -- ─────────────────────────────────────────────────────────────
    --   { "<leader>p", group = "Пакеты", icon = "" },
    --   { "<leader>pi", desc = "Установить плагины" },
    --   { "<leader>ps", desc = "Статус плагинов" },
    --   { "<leader>pS", desc = "Синхронизация плагинов" },
    --   { "<leader>pu", desc = "Проверить обновления" },
    --   { "<leader>pU", desc = "Обновить плагины" },
    --   { "<leader>pm", desc = "Mason" },
    --   { "<leader>pM", desc = "Обновить Mason" },

    --   -- ─────────────────────────────────────────────────────────────
    --   -- Quick actions (без группы)
    --   -- ─────────────────────────────────────────────────────────────
    --   { "<leader>w", desc = "Сохранить", icon = "" },
    --   { "<leader>W", desc = "Сохранить всё", icon = "" },
    --   { "<leader>q", desc = "Закрыть окно", icon = "" },
    --   { "<leader>Q", desc = "Выйти из Neovim", icon = "" },
    --   { "<leader>c", desc = "Закрыть буфер", icon = "" },
    --   { "<leader>C", desc = "Принудительно закрыть буфер", icon = "" },
    --   { "<leader>n", desc = "Новый файл", icon = "" },
    --   { "<leader>e", desc = "Файловый менеджер", icon = "" },
    --   { "<leader>o", desc = "Фокус на файловом менеджере", icon = "" },
    --   { "<leader>h", desc = "Стартовый экран", icon = "" },
    --   { "<leader>/", desc = "Поиск по буферу", icon = "" },
    --   { "<leader>:", desc = "История команд", icon = "" },
    --   { "<leader>.", desc = "Черновой буфер (scratch)", icon = "" },

    --   -- Clipboard
    --   { "<leader>y", desc = "Копировать в системный буфер", mode = { "n", "v" }, icon = "" },
    --   { "<leader>Y", desc = "Копировать строку в буфер", icon = "" },
    --   { "<leader>d", desc = "Удалить в чёрную дыру", mode = { "n", "v" }, icon = "" },
    --   { "<leader>p", desc = "Вставить (не заменяя регистр)", mode = "x", icon = "" },

    --   -- Toggle
    --   { "<leader>i", desc = "Переключить значение", icon = "󰓡" },
    -- })
  end,
}
